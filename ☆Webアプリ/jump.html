<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ã‚¸ãƒ£ãƒ³ãƒ—ã‚²ãƒ¼ãƒ  â€” ã‚¹ãƒãƒ›å¯¾å¿œç‰ˆ</title>
<style>
  canvas { 
    border:1px solid black; 
    background:lightblue; 
    display:block; 
    margin:auto; 
    max-width:100%; 
    height:auto;
    touch-action:none; /* ã‚¿ãƒƒãƒ—æ“ä½œã§ç”»é¢ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ãªã„ */
  }
  body { text-align:center; font-family:sans-serif; }
</style>
</head>
<body>
<h2>ã‚¸ãƒ£ãƒ³ãƒ—ã‚²ãƒ¼ãƒ  ğŸˆï¼ˆã‚¹ãƒãƒ›å¯¾å¿œç‰ˆï¼‰</h2>
<p>é’ï¼ˆzigzagï¼‰ï¼šæ¥è§¦ã§HP1æ¸›å°‘</p>
<p>ã‚ªãƒ¬ãƒ³ã‚¸ï¼ˆbreakableï¼‰ï¼šè¸ã‚€ã¨å£Šã›ã‚‹ã€‚å£Šã™ã¨ã‚¹ã‚³ã‚¢ï¼‹5ã€æ™‚é–“å»¶é•·ï¼‹1ç§’ã€å¼¾ã‹ã‚Œã‚‹</p>
<p>é¢¨èˆ¹ï¼ˆballoonï¼‰ï¼šã©ã“ã‹ã‚‰è§¦ã‚Œã¦ã‚‚å€’ã›ã‚‹ã€‚ä¸Šã‹ã‚‰è¸ã‚€ã¨ä¸Šã«å¼¾ã‹ã‚Œã€ä¸‹ã‹ã‚‰è§¦ã‚Œã‚‹ã¨ä¸‹ã«å¼¾ã‹ã‚Œã‚‹</p>
<p>è½ã¨ã—ç©´ï¼šè½ã¡ã‚‹ã¨å³æ­»ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ»åœ°é¢æ•µã¨ã‚‚è½ä¸‹æ¼”å‡ºã‚ã‚Šï¼‰</p>
<p>ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ï¼ã‚¿ãƒƒãƒ—ã§ã‚¸ãƒ£ãƒ³ãƒ—ï¼ï¼ˆç©ºä¸­ã¯2æ®µã¾ã§ï¼‰ Enterï¼ã‚¿ãƒƒãƒ—ã§ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ</p>

<canvas id="game" width="400" height="300"></canvas>
<p id="score">ã‚¹ã‚³ã‚¢:0 | æ®‹ã‚Šç§’:100 | HP:3</p>
<p id="status"></p>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const scoreDisplay = document.getElementById("score");
const statusDisplay = document.getElementById("status");

// ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼
let player = { x:50, y:250, vy:0, size:20, falling:false };
let jumpStage = 0, maxJumpStage = 2;

// éšœå®³ç‰©ãƒ»çˆ†ç™ºãƒ»ç©´
let obstacles = []; 
let explosions = [];
let holes = [];     

// ã‚²ãƒ¼ãƒ çŠ¶æ…‹
let score = 0, gameOver = false;
let spawnTimer = 0, holeTimer = 0;
let gameTime = 6000; // 100ç§’
let hp = 3, invincible = 0, flash = 0;

// ã‚­ãƒ¼æ“ä½œ
document.addEventListener("keydown", e=>{
  if(e.code==="Space" && jumpStage<maxJumpStage && !gameOver && !player.falling){
    jumpStage++;
    player.vy = (jumpStage===1)? -8:-12;
  }
  if(e.code==="Enter" && gameOver) restart();
});

// ã‚¿ãƒƒãƒ—æ“ä½œï¼ˆã‚¹ãƒãƒ›å¯¾å¿œï¼‰
canvas.addEventListener("touchstart", e=>{
  e.preventDefault();
  if(!gameOver && !player.falling){
    if(jumpStage < maxJumpStage){
      jumpStage++;
      player.vy = (jumpStage===1)? -8 : -12;
    }
  } else if(gameOver){
    restart();
  }
});

// æ•µç”Ÿæˆ
function spawnObstacle(){
  const count = Math.floor(Math.random()*3)+1;
  for(let i=0;i<count;i++){
    const types = ["normal","zigzag","breakable","balloon"];
    const type = types[Math.floor(Math.random()*types.length)];
    let yPos, baseY;

    if(type==="balloon"){
      yPos = Math.floor(Math.random()*100)+50; 
    } else if(type==="zigzag"){
      baseY = 200 + Math.floor(Math.random()*80);
      yPos = baseY;
    } else {
      yPos = (Math.random()<0.5)? 250 : Math.floor(Math.random()*100)+100;
    }

    obstacles.push({
      x: 400 + i*30,
      y: yPos,
      width: 20,
      height: 20,
      type: type,
      angle: 0,
      vy: 0,
      falling: false,
      baseY: baseY
    });
  }
}

// ç©´ç”Ÿæˆ
function spawnHoleIfReady(){
  holeTimer++;
  if(holeTimer>=120){
    if(Math.random()<0.5) holes.push({x:400, width:40});
    holeTimer=0;
  }
}

// éšœå®³ç‰©æ›´æ–°
function updateObstacles(){
  for(let ob of obstacles){
    if(ob.falling){
      ob.vy += 0.6;
      ob.y += ob.vy;
    } else {
      ob.x -= (ob.type==="balloon")?1.5:3;

      if(ob.type==="zigzag" && ob.baseY!==undefined){
        ob.y = ob.baseY + Math.sin(ob.angle)*30;
        ob.angle += 0.12;
      }

      if(ob.type==="balloon"){
        ob.y += Math.sin(ob.angle)*0.5;
        ob.x += Math.sin(ob.angle/2)*0.5;
        ob.angle += 0.05;
      }

      // åœ°é¢æ•µãŒç©´ä¸Šãªã‚‰è½ä¸‹
      if(!ob.falling && (ob.type==="normal"||ob.type==="breakable")){
        for(let h of holes){
          if(ob.x+ob.width>h.x && ob.x<h.x+h.width && ob.y>=230){
            ob.falling = true;
            ob.vy = 2;
            break;
          }
        }
      }
    }
  }

  obstacles = obstacles.filter(ob=>{
    if(ob.falling && ob.y>canvas.height+50) return false;
    if(!ob.falling && ob.x<-ob.width){ score++; return false; }
    return true;
  });

  holes.forEach(h=>h.x -= 3);
  holes = holes.filter(h=>h.x+h.width>0);
}

// è¡çªåˆ¤å®š
function checkCollision(){
  if(invincible>0 || player.falling) return;

  for(let i=0;i<obstacles.length;i++){
    let ob = obstacles[i];
    if(ob.falling) continue;

    if(ob.type==="balloon"){
      const dx = (player.x+player.size/2)-(ob.x+ob.width/2);
      const dy = (player.y+player.size/2)-(ob.y+ob.height/2);
      if(Math.sqrt(dx*dx+dy*dy)<player.size/2+16){
        explosions.push({x:ob.x+ob.width/2,y:ob.y+ob.height/2,radius:0,maxRadius:30});
        obstacles.splice(i,1); i--; score+=5; gameTime+=60;
        player.vy = (player.y+player.size/2<ob.y+ob.height/2)?-10:5;
        invincible=30; flash=10;
        continue;
      }
    } else {
      if(player.x<ob.x+ob.width && player.x+player.size>ob.x &&
         player.y<ob.y+ob.height && player.y+player.size>ob.y){
        if(ob.type==="breakable" && player.vy>0 && player.y+player.size<=ob.y+10){
          explosions.push({x:ob.x+ob.width/2,y:ob.y+ob.height/2,radius:0,maxRadius:30});
          obstacles.splice(i,1); i--; score+=5; gameTime+=60; player.vy=-8; continue;
        }
        hp--; invincible=30; flash=10;
        if(hp<=0) return endGame();
      }
    }
  }

  // ç©´åˆ¤å®š
  const footY = player.y + player.size;
  const footXCenter = player.x + player.size/2;
  for(let h of holes){
    const margin = 4; 
    if(!player.falling && footY >= 270 &&
       footXCenter > h.x + margin && footXCenter < h.x + h.width - margin){
      player.falling = true;
      player.vy = 2;
      break;
    }
  }
}

// çˆ†ç™ºæ›´æ–°
function updateExplosions(){
  explosions.forEach(exp=>exp.radius+=2);
  explosions = explosions.filter(exp=>exp.radius<exp.maxRadius);
}

// æç”»
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="saddlebrown"; ctx.fillRect(0,270,canvas.width,canvas.height-270);

  for(let ob of obstacles){
    if(ob.type==="balloon"){
      ctx.beginPath();
      ctx.arc(ob.x+ob.width/2,ob.y+ob.height/2,12,0,Math.PI*2);
      ctx.fillStyle="pink"; ctx.fill();
      ctx.beginPath();
      ctx.moveTo(ob.x+ob.width/2,ob.y+ob.height/2+12);
      ctx.lineTo(ob.x+ob.width/2,ob.y+ob.height/2+20);
      ctx.stroke();
    } else {
      ctx.fillStyle=(ob.type==="normal")?"green":(ob.type==="zigzag")?"blue":"orange";
      ctx.globalAlpha = ob.falling?0.7:1.0;
      ctx.fillRect(ob.x,ob.y,ob.width,ob.height);
      ctx.globalAlpha = 1.0;
    }
  }

  ctx.fillStyle="black"; holes.forEach(h=>ctx.fillRect(h.x,270,h.width,30));

  for(let exp of explosions){
    ctx.beginPath();
    ctx.arc(exp.x,exp.y,exp.radius,0,Math.PI*2);
    ctx.fillStyle="rgba(255,165,0,0.5)"; ctx.fill();
  }

  if(flash>0){
    ctx.fillStyle="rgba(255,255,255,0.5)";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    flash--;
  }

  ctx.fillStyle="red"; ctx.fillRect(player.x,player.y,player.size,player.size);
  ctx.fillStyle="gray"; ctx.fillRect(10,10,60,10);
  ctx.fillStyle="lime"; ctx.fillRect(10,10,20*Math.max(0,hp),10);
}

// ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—
function loop(){
  if(gameOver) return;

  gameTime--;
  if(gameTime<=0){ statusDisplay.textContent="æ™‚é–“åˆ‡ã‚Œï¼ ã‚¿ãƒƒãƒ—ã¾ãŸã¯Enterã§ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ"; return endGame(); }

  if(player.falling){
    player.vy+=0.9; player.y+=player.vy;
    if(player.y>canvas.height+40) return endGame();
  } else {
    player.vy+=0.5; player.y+=player.vy;
    if(player.y>250){ player.y=250; player.vy=0; jumpStage=0; }
  }

  spawnTimer++; if(spawnTimer>90){ spawnObstacle(); spawnTimer=0; }
  spawnHoleIfReady();

  updateObstacles();
  if(invincible>0) invincible--;
  if(!player.falling) checkCollision();
  updateExplosions();

  draw();
  scoreDisplay.textContent=`ã‚¹ã‚³ã‚¢:${score} | æ®‹ã‚Šç§’:${Math.floor(gameTime/60)} | HP:${hp}`;

  requestAnimationFrame(loop);
}

function endGame(){
  gameOver = true;
  statusDisplay.textContent="ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼ ã‚¿ãƒƒãƒ—ã¾ãŸã¯Enterã§ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ";
}

function restart(){
  player.x = 50;
  player.y = 250;
  player.vy = 0;
  player.falling = false;

  jumpStage = 0;
  obstacles = [];
  explosions = [];
  holes = [];

  score = 0;
  gameOver = false;
  spawnTimer = 0;
  holeTimer = 0;
  gameTime = 6000;
  hp = 3;
  invincible = 0;
  flash = 0;
  statusDisplay.textContent = "";

  loop();
}

// ã‚²ãƒ¼ãƒ é–‹å§‹
loop();
</script>
</body>
</html>
